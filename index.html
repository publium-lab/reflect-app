<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>REFLECT</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="theme-color" content="#000000"/>
<link rel="manifest" href="manifest.json"/>

<style>
body{margin:0;font-family:-apple-system;background:#000;color:#fff;padding:20px}
h1{font-size:28px}
textarea{width:100%;height:120px;background:#111;color:#fff;border:1px solid #333;padding:12px;border-radius:8px}
button{width:100%;padding:14px;margin-top:12px;border:none;border-radius:8px;font-weight:bold}
.primary{background:#fff;color:#000}
.secondary{background:#111;color:#fff;border:1px solid #333}
.response{margin-top:20px;white-space:pre-line;line-height:1.6}
.mode{margin-top:10px}
.lock{opacity:.4}
hr{border:0;border-top:1px solid #333;margin:20px 0}
</style>
</head>

<body>
<h1>REFLECT</h1>
<p>The truth you avoid.</p>

<textarea id="input" placeholder="Write one situation, thought, or doubt..."></textarea>

<div class="mode">
<button class="secondary" onclick="setMode('soft')">Soft Truth</button>
<button class="secondary lock" onclick="locked()">Brutal Honesty ðŸ”’</button>
<button class="secondary lock" onclick="locked()">Self-Sabotage ðŸ”’</button>
<button class="secondary lock" onclick="locked()">Relationship Reality ðŸ”’</button>
</div>

<button class="primary" onclick="reflect()">REFLECT</button>

<div class="response" id="output"></div>

<hr/>
<h3>History</h3>
<div id="history"></div>

<script>
const LIMIT = 2;
let count = localStorage.getItem("count") || 0;
let mode = "soft";

function setMode(m){ mode = m; }

function locked(){
window.location.href = "https://buy.stripe.com/test_dRm7sK562dUo2eubnm6Na00";


REFLECT can go deeper.
Patterns. Avoidance. Repetition.

Upgrade to unlock full clarity.`;
}

async function reflect(){
if(count >= LIMIT){
  locked();
  return;
}

const input = document.getElementById("input").value;
if(!input) return;

count++;
localStorage.setItem("count", count);

document.getElementById("output").innerText = "Reflecting...";

const systemPrompt = `
You are REFLECT.
Mode: ${mode.toUpperCase()}

Structure EXACTLY:
1. WHAT YOU SAY
2. WHAT IT REVEALS
3. THE MOST LIKELY TRUTH

No advice. No reassurance. Calm. Honest.
`;

const res = await fetch("https://api.openai.com/v1/chat/completions",{
method:"POST",
headers:{
"Content-Type":"application/json",
"Authorization":"Bearer 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"
},
body:JSON.stringify({
model:"gpt-4o-mini",
temperature:0.3,
messages:[
{role:"system",content:systemPrompt},
{role:"user",content:input}
]
})
});

const data = await res.json();
const reply = data.choices[0].message.content;

document.getElementById("output").innerText = reply;

let history = JSON.parse(localStorage.getItem("history") || "[]");
history.unshift(reply);
localStorage.setItem("history", JSON.stringify(history));
renderHistory();
}

function renderHistory(){
let h = JSON.parse(localStorage.getItem("history") || "[]");
document.getElementById("history").innerHTML = h.map(x=>`<p>${x}</p>`).join("");
}

renderHistory();
</script>

<script>
if("serviceWorker"in navigator){
navigator.serviceWorker.register("service-worker.js");
}
</script>
</body>
</html>
